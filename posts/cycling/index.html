<!DOCTYPE html><html lang="en-US" mode="dark" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="generator" content="Jekyll v4.4.1" /><meta property="og:title" content="Cycling" /><meta property="og:locale" content="en_US" /><meta name="description" content="Source code" /><meta property="og:description" content="Source code" /><link rel="canonical" href="http://susanou.github.io/Writeups/posts/cycling/" /><meta property="og:url" content="http://susanou.github.io/Writeups/posts/cycling/" /><meta property="og:site_name" content="Writeups" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2022-07-03T00:00:00+02:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Cycling" /><meta name="twitter:site" content="@twitter_username" /><meta name="google-site-verification" content="google_meta_tag_verification" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2022-07-07T18:09:02+02:00","datePublished":"2022-07-03T00:00:00+02:00","description":"Source code","headline":"Cycling","mainEntityOfPage":{"@type":"WebPage","@id":"http://susanou.github.io/Writeups/posts/cycling/"},"url":"http://susanou.github.io/Writeups/posts/cycling/"}</script><title>Cycling | Writeups</title><link rel="apple-touch-icon" sizes="180x180" href="/Writeups/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/Writeups/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/Writeups/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/Writeups/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/Writeups/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="Writeups"><meta name="application-name" content="Writeups"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/Writeups/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="preconnect" href="https://cdn.jsdelivr.net"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/Writeups/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1.1.0/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script defer src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.15.0,npm/bootstrap@4/dist/js/bootstrap.min.js"></script> <script async src="https://cdn.jsdelivr.net/combine/npm/lozad/dist/lozad.min.js,npm/magnific-popup@1/dist/jquery.magnific-popup.min.js"></script> <script defer src="/Writeups/assets/js/dist/post.min.js"></script> <script> /* see: <https://docs.mathjax.org/en/latest/options/input/tex.html#tex-options> */ MathJax = { tex: { inlineMath: [ /* start/end delimiter pairs for in-line math */ ['$','$'], ['\\(','\\)'] ], displayMath: [ /* start/end delimiter pairs for display math */ ['$$', '$$'], ['\\[', '\\]'] ] } }; </script> <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script> <script type="text/javascript" id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"> </script> <script defer src="/Writeups/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id="></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', ''); }); </script><body data-spy="scroll" data-target="#toc"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/Writeups/" alt="avatar" class="mx-auto"> <img src="/Writeups/assets/img/sample/avatar.png" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/Writeups/">Writeups</a></div><div class="site-subtitle font-italic">Student by day Hacker by night</div></div><ul class="w-100"><li class="nav-item"> <a href="/Writeups/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/Writeups/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/Writeups/tags/" class="nav-link"> <i class="fa-fw fas fa-tags ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/Writeups/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/Writeups/about/" class="nav-link"> <i class="fa-fw fas fa-info ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center"> <a href="https://github.com/Susanou" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github-alt"></i> </a> <a href="https://app.hackthebox.eu/profile/337512" aria-label="htb" target="_blank" rel="noopener"> <i class="fas fa-cube"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['cam.hochberg','gmail.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/Writeups/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a> <a href="https://www.linkedin.com/in/cam-hochberg/" aria-label="linkedin" target="_blank" rel="noopener"> <i class="fab fa-linkedin"></i> </a></div></div><div id="topbar-wrapper" class="row justify-content-center topbar-down"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/Writeups/"> Posts </a> </span> <span>Cycling</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="post-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>Cycling</h1><div class="post-meta text-muted d-flex flex-column"><div> <span class="semi-bold"> Cameron Hochberg </span> <span class="timeago " data-toggle="tooltip" data-placement="bottom" title="Sun, Jul 3, 2022, 12:00 AM +0200" prep="on" > Jul 3, 2022 <i class="unloaded">2022-07-03T00:00:00+02:00</i> </span></div><div> <span> <span class="timeago lastmod" data-toggle="tooltip" data-placement="bottom" title="Thu, Jul 7, 2022, 6:09 PM +0200" prefix="Updated " > Jul 7, 2022 <i class="unloaded">2022-07-07T18:09:02+02:00</i> </span> </span> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="1169 words">6 min</span></div></div><div class="post-content"><h1 id="source-code">Source code</h1><div class="language-python highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
</pre><td class="rouge-code"><pre><span class="c1">#!/usr/bin/python3
</span>
<span class="c1"># Copyright 2022 Google LLC
#
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#      http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.
</span>
<span class="sh">"""</span><span class="s">
It is well known that any RSA encryption can be undone by just encrypting the
ciphertext over and over again. If the RSA modulus has been chosen badly then
the number of encryptions necessary to undo an encryption is small.
If n = 0x112b00148621 then only 209 encryptions are necessary as the following
example demonstrates:
</span><span class="gp">
&gt;&gt;&gt;</span> <span class="n">e</span> <span class="o">=</span> <span class="mi">65537</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">n</span> <span class="o">=</span> <span class="mh">0x112b00148621</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">pt</span> <span class="o">=</span> <span class="mh">0xdeadbeef</span>
<span class="o">&gt;&gt;&gt;</span> <span class="c1"># Encryption
</span><span class="o">&gt;&gt;&gt;</span> <span class="n">ct</span> <span class="o">=</span> <span class="nf">pow</span><span class="p">(</span><span class="n">pt</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="c1"># Decryption via cycling:
</span><span class="o">&gt;&gt;&gt;</span> <span class="n">pt</span> <span class="o">=</span> <span class="n">ct</span>
<span class="o">&gt;&gt;&gt;</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nf">range</span><span class="p">(</span><span class="mi">209</span><span class="p">):</span>
<span class="o">&gt;&gt;&gt;</span> <span class="err"> </span> <span class="n">pt</span> <span class="o">=</span> <span class="nf">pow</span><span class="p">(</span><span class="n">pt</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="c1"># Assert decryption worked:
</span><span class="o">&gt;&gt;&gt;</span> <span class="k">assert</span> <span class="n">ct</span> <span class="o">==</span> <span class="nf">pow</span><span class="p">(</span><span class="n">pt</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>

<span class="s">However, if the modulus is well chosen then a cycle attack can take much longer.
This property can be used for a timed release of a message. We have confirmed
that it takes a whopping 2^1025-3 encryptions to decrypt the flag. Pack out
your quantum computer and perform 2^1025-3 encryptions to solve this
challenge. Good luck doing this in 48h.
</span><span class="sh">"""</span>

<span class="n">e</span> <span class="o">=</span> <span class="mi">65537</span>
<span class="n">n</span> <span class="o">=</span> <span class="mh">0x99efa9177387907eb3f74dc09a4d7a93abf6ceb7ee102c689ecd0998975cede29f3ca951feb5adfb9282879cc666e22dcafc07d7f89d762b9ad5532042c79060cdb022703d790421a7f6a76a50cceb635ad1b5d78510adf8c6ff9645a1b179e965358e10fe3dd5f82744773360270b6fa62d972d196a810e152f1285e0b8b26f5d54991d0539a13e655d752bd71963f822affc7a03e946cea2c4ef65bf94706f20b79d672e64e8faac45172c4130bfeca9bef71ed8c0c9e2aa0a1d6d47239960f90ef25b337255bac9c452cb019a44115b0437726a9adef10a028f1e1263c97c14a1d7cd58a8994832e764ffbfcc05ec8ed3269bb0569278eea0550548b552b1</span>
<span class="n">ct</span> <span class="o">=</span> <span class="mh">0x339be515121dab503106cd190897382149e032a76a1ca0eec74f2c8c74560b00dffc0ad65ee4df4f47b2c9810d93e8579517692268c821c6724946438a9744a2a95510d529f0e0195a2660abd057d3f6a59df3a1c9a116f76d53900e2a715dfe5525228e832c02fd07b8dac0d488cca269e0dbb74047cf7a5e64a06a443f7d580ee28c5d41d5ede3604825eba31985e96575df2bcc2fefd0c77f2033c04008be9746a0935338434c16d5a68d1338eabdcf0170ac19a27ec832bf0a353934570abd48b1fe31bc9a4bb99428d1fbab726b284aec27522efb9527ddce1106ba6a480c65f9332c5b2a3c727a2cca6d6951b09c7c28ed0474fdc6a945076524877680</span>
<span class="c1"># Decryption via cycling:
</span><span class="n">pt</span> <span class="o">=</span> <span class="n">ct</span>
<span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nf">range</span><span class="p">(</span><span class="mi">2</span><span class="o">**</span><span class="mi">1025</span> <span class="o">-</span> <span class="mi">3</span><span class="p">):</span>
  <span class="n">pt</span> <span class="o">=</span> <span class="nf">pow</span><span class="p">(</span><span class="n">pt</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
<span class="c1"># Assert decryption worked:
</span><span class="k">assert</span> <span class="n">ct</span> <span class="o">==</span> <span class="nf">pow</span><span class="p">(</span><span class="n">pt</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>

<span class="c1"># Print flag:
</span><span class="nf">print</span><span class="p">(</span><span class="n">pt</span><span class="p">.</span><span class="nf">to_bytes</span><span class="p">((</span><span class="n">pt</span><span class="p">.</span><span class="nf">bit_length</span><span class="p">()</span> <span class="o">+</span> <span class="mi">7</span><span class="p">)</span><span class="o">//</span><span class="mi">8</span><span class="p">,</span> <span class="sh">'</span><span class="s">big</span><span class="sh">'</span><span class="p">).</span><span class="nf">decode</span><span class="p">())</span>

</pre></table></code></div></div><h1 id="solutions">Solutions</h1><h2 id="attack-1-factoring-n">Attack 1: Factoring n</h2><p>From the name and the description of the challenge, it is pretty clear that this is somehow related to the cycling attack on RSA.</p><h3 id="the-original-attack">The original attack</h3><p>As described in <a href="https://documents.uow.edu.au/~jennie/WEBPDF/1999_07.pdf">this paper</a>, the attack works as follows:</p><p>Given a <code class="language-plaintext highlighter-rouge">seed</code> and a boundary <code class="language-plaintext highlighter-rouge">B</code> on top of the public key parameters,</p>\[set\ x_0 = Enc(seed)\ where\ Enc\ is\ the\ encryption\ function\] \[set\ start = |log(n)|\] \[while\ i \leq start\] \[set\ x_{i+1} = Enc(x_i)\ mod\ n\] \[while\ test \not= 1\ or\ i &gt; B\] \[set\ x_{i+1} = Enc(x_i)\ mod\ n\] \[set\ test = gcd(x_{i+1} - x_{start}, n)\]<p>The first while loop only exists in case there exists an aperiodic part in the sequence and could be skipped. In the paper however, they do describe how to prevent such an attack and it seems like what we were given achieved exactly that.</p><h3 id="the-flaw">The flaw</h3><p>Now however, we are given another import information:</p><blockquote><p>We have confirmed that it takes a whopping 2^1025-3 encryptions to decrypt the flag</p></blockquote><p>With this we are given the order of the order of the modulus or in other words:</p>\[\lambda(\lambda(n))\]<p>Where $\lambda$ is the Carmichael Function which is defined as [1]:</p>\[\lambda(2^k) = 2\lambda(2^{k-1})\] \[\lambda(p) = p-1, \lambda(p^k) = p\lambda(p^{k-1})\] \[\lambda(n) = lcm (\lambda(p_1^{e_1}), \lambda(p_2^{e_2}), ...., \lambda(p_j^{e_j}))\ where\ n = \prod_{i=1}^jp_i^{e_j}\]<h3 id="the-attack">The attack</h3><p>Now let’s set $\lambda(n) = x$ we are given $\lambda(x) = 2^{1025}-2$. Using factordb we can easily find the factors and realize that none of them have a power of 2 or more. With this list, we can now find another list of potential prime numbers $p_i$ that would be able to make such a $\lambda(x)$. This list has potential candidates of lambda factors and using these we can try and find the actual $\lambda(n)=\phi(n)$.</p><p>Reminder, euler’s theroem states that:</p>\[\alpha^{\phi(n)} = 1\ mod\ n\]<p>as long as $\alpha$ and $n$ are relatively prime. Picking 2 in this case ensures that so now there is only to subtract 1 and if we find $\phi(n)$ then we will get a factor</p><h3 id="solve-script">Solve script</h3><div class="language-python highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
</pre><td class="rouge-code"><pre><span class="kn">from</span> <span class="n">math</span> <span class="kn">import</span> <span class="n">gcd</span>
<span class="kn">import</span> <span class="n">itertools</span>
<span class="kn">from</span> <span class="n">operator</span> <span class="kn">import</span> <span class="n">mul</span>
<span class="kn">from</span> <span class="n">functools</span> <span class="kn">import</span> <span class="nb">reduce</span>

<span class="n">e</span> <span class="o">=</span> <span class="mi">65537</span>
<span class="n">n</span> <span class="o">=</span> <span class="mh">0x99efa9177387907eb3f74dc09a4d7a93abf6ceb7ee102c689ecd0998975cede29f3ca951feb5adfb9282879cc666e22dcafc07d7f89d762b9ad5532042c79060cdb022703d790421a7f6a76a50cceb635ad1b5d78510adf8c6ff9645a1b179e965358e10fe3dd5f82744773360270b6fa62d972d196a810e152f1285e0b8b26f5d54991d0539a13e655d752bd71963f822affc7a03e946cea2c4ef65bf94706f20b79d672e64e8faac45172c4130bfeca9bef71ed8c0c9e2aa0a1d6d47239960f90ef25b337255bac9c452cb019a44115b0437726a9adef10a028f1e1263c97c14a1d7cd58a8994832e764ffbfcc05ec8ed3269bb0569278eea0550548b552b1</span>
<span class="n">ct</span> <span class="o">=</span> <span class="mh">0x339be515121dab503106cd190897382149e032a76a1ca0eec74f2c8c74560b00dffc0ad65ee4df4f47b2c9810d93e8579517692268c821c6724946438a9744a2a95510d529f0e0195a2660abd057d3f6a59df3a1c9a116f76d53900e2a715dfe5525228e832c02fd07b8dac0d488cca269e0dbb74047cf7a5e64a06a443f7d580ee28c5d41d5ede3604825eba31985e96575df2bcc2fefd0c77f2033c04008be9746a0935338434c16d5a68d1338eabdcf0170ac19a27ec832bf0a353934570abd48b1fe31bc9a4bb99428d1fbab726b284aec27522efb9527ddce1106ba6a480c65f9332c5b2a3c727a2cca6d6951b09c7c28ed0474fdc6a945076524877680</span>

<span class="c1">#factordb
</span><span class="n">primes</span> <span class="o">=</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">17</span><span class="p">,</span> <span class="mi">257</span><span class="p">,</span> <span class="mi">641</span><span class="p">,</span> <span class="mi">65537</span><span class="p">,</span> <span class="mi">274177</span><span class="p">,</span> <span class="mi">2424833</span><span class="p">,</span> <span class="mi">6700417</span><span class="p">,</span> <span class="mi">67280421310721</span><span class="p">,</span> <span class="mi">1238926361552897</span><span class="p">,</span> <span class="mi">59649589127497217</span><span class="p">,</span> <span class="mi">5704689200685129054721</span><span class="p">,</span> <span class="mi">7455602825647884208337395736200454918783366342657</span><span class="p">,</span> <span class="mi">93461639715357977769163558199606896584051237541638188580280321</span><span class="p">,</span> <span class="mi">741640062627530801524787141901937474059940781097519023905821316144415759504705008092818711693940737</span><span class="p">]</span>

<span class="c1">#cycling attack with potential factors of lm(x)
</span><span class="n">huge</span> <span class="o">=</span> <span class="mi">2</span>
<span class="n">huge</span> <span class="o">=</span> <span class="nf">pow</span><span class="p">(</span><span class="n">huge</span><span class="p">,</span> <span class="nf">reduce</span><span class="p">(</span><span class="n">mul</span><span class="p">,</span> <span class="n">primes</span><span class="p">)</span><span class="o">**</span><span class="mi">4</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">itertools</span><span class="p">.</span><span class="n">chain</span><span class="p">.</span><span class="nf">from_iterable</span><span class="p">([</span><span class="n">itertools</span><span class="p">.</span><span class="nf">combinations</span><span class="p">(</span><span class="n">primes</span><span class="p">,</span> <span class="n">j</span><span class="p">),</span><span class="nf">print</span><span class="p">(</span><span class="n">j</span><span class="p">)][</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nf">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="nf">len</span><span class="p">(</span><span class="n">primes</span><span class="p">))):</span>
	<span class="n">huge</span> <span class="o">=</span> <span class="nf">pow</span><span class="p">(</span><span class="n">huge</span><span class="p">,</span> <span class="nf">reduce</span><span class="p">(</span><span class="n">mul</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
	<span class="n">g</span> <span class="o">=</span> <span class="nf">gcd</span><span class="p">(</span><span class="n">huge</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
	<span class="k">if</span> <span class="n">g</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
		<span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">found factor</span><span class="sh">"</span><span class="p">,</span><span class="n">g</span><span class="p">)</span>
		<span class="k">break</span>
	<span class="k">if</span> <span class="n">huge</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
		<span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">you goofed</span><span class="sh">"</span><span class="p">)</span>
		<span class="k">break</span>
<span class="n">p</span> <span class="o">=</span> <span class="n">g</span>
<span class="k">assert</span> <span class="n">n</span><span class="o">%</span><span class="n">p</span> <span class="o">==</span> <span class="mi">0</span>
<span class="nf">print</span><span class="p">(</span><span class="n">n</span><span class="o">//</span><span class="n">p</span><span class="p">)</span>

<span class="c1"># RSA decryption
</span><span class="n">q</span> <span class="o">=</span> <span class="n">n</span><span class="o">//</span><span class="n">p</span>
<span class="n">phi</span> <span class="o">=</span> <span class="p">(</span><span class="n">p</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">q</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<span class="n">d</span> <span class="o">=</span> <span class="nf">pow</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">phi</span><span class="p">)</span>
<span class="n">pt</span> <span class="o">=</span> <span class="nf">pow</span><span class="p">(</span><span class="n">ct</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>

<span class="nf">print</span><span class="p">(</span><span class="n">pt</span><span class="p">.</span><span class="nf">to_bytes</span><span class="p">((</span><span class="n">pt</span><span class="p">.</span><span class="nf">bit_length</span><span class="p">()</span> <span class="o">+</span> <span class="mi">7</span><span class="p">)</span><span class="o">//</span><span class="mi">8</span><span class="p">,</span> <span class="sh">'</span><span class="s">big</span><span class="sh">'</span><span class="p">))</span>
</pre></table></code></div></div><h2 id="attack-2-using-lambda-to-get-to-the-private-key">Attack 2: Using lambda to get to the private key</h2><p>This second attack isn’t what the offical used but still interesting. While in the previous one, we picked between all the possible condidate factors of $\lambda(n)$ until we found the right ones to factorize, we also know that the list we have will contain all the factors. Thus there product will be by definition a multiple of $\lambda(n)$. This more than enough to reconstruct the private key and thus we can use this to attack:</p><h3 id="solve-script-1">Solve Script</h3><div class="language-python highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
</pre><td class="rouge-code"><pre><span class="kn">from</span> <span class="n">gmpy2</span> <span class="kn">import</span> <span class="n">mpz</span>
<span class="kn">from</span> <span class="n">itertools</span> <span class="kn">import</span> <span class="n">product</span> <span class="k">as</span> <span class="n">iter_product</span>
<span class="kn">from</span> <span class="n">tqdm.auto</span> <span class="kn">import</span> <span class="n">tqdm</span>

<span class="n">e</span> <span class="o">=</span> <span class="mi">65537</span>
<span class="n">n</span> <span class="o">=</span> <span class="mh">0x99efa9177387907eb3f74dc09a4d7a93abf6ceb7ee102c689ecd0998975cede29f3ca951feb5adfb9282879cc666e22dcafc07d7f89d762b9ad5532042c79060cdb022703d790421a7f6a76a50cceb635ad1b5d78510adf8c6ff9645a1b179e965358e10fe3dd5f82744773360270b6fa62d972d196a810e152f1285e0b8b26f5d54991d0539a13e655d752bd71963f822affc7a03e946cea2c4ef65bf94706f20b79d672e64e8faac45172c4130bfeca9bef71ed8c0c9e2aa0a1d6d47239960f90ef25b337255bac9c452cb019a44115b0437726a9adef10a028f1e1263c97c14a1d7cd58a8994832e764ffbfcc05ec8ed3269bb0569278eea0550548b552b1</span>
<span class="n">ct</span> <span class="o">=</span> <span class="mh">0x339be515121dab503106cd190897382149e032a76a1ca0eec74f2c8c74560b00dffc0ad65ee4df4f47b2c9810d93e8579517692268c821c6724946438a9744a2a95510d529f0e0195a2660abd057d3f6a59df3a1c9a116f76d53900e2a715dfe5525228e832c02fd07b8dac0d488cca269e0dbb74047cf7a5e64a06a443f7d580ee28c5d41d5ede3604825eba31985e96575df2bcc2fefd0c77f2033c04008be9746a0935338434c16d5a68d1338eabdcf0170ac19a27ec832bf0a353934570abd48b1fe31bc9a4bb99428d1fbab726b284aec27522efb9527ddce1106ba6a480c65f9332c5b2a3c727a2cca6d6951b09c7c28ed0474fdc6a945076524877680</span>

<span class="n">primes</span> <span class="o">=</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">17</span><span class="p">,</span> <span class="mi">257</span><span class="p">,</span> <span class="mi">641</span><span class="p">,</span> <span class="mi">65537</span><span class="p">,</span> <span class="mi">274177</span><span class="p">,</span> <span class="mi">2424833</span><span class="p">,</span> <span class="mi">6700417</span><span class="p">,</span> <span class="mi">67280421310721</span><span class="p">,</span> <span class="mi">1238926361552897</span><span class="p">,</span> <span class="mi">59649589127497217</span><span class="p">,</span> <span class="mi">5704689200685129054721</span><span class="p">,</span> <span class="mi">7455602825647884208337395736200454918783366342657</span><span class="p">,</span> <span class="mi">93461639715357977769163558199606896584051237541638188580280321</span><span class="p">,</span> <span class="mi">741640062627530801524787141901937474059940781097519023905821316144415759504705008092818711693940737</span><span class="p">]</span>

<span class="k">assert</span> <span class="nf">product</span><span class="p">(</span><span class="n">primes</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="o">^</span><span class="mi">1025</span> <span class="o">-</span> <span class="mi">2</span>
<span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">Number of q_i =</span><span class="sh">"</span><span class="p">,</span> <span class="nf">len</span><span class="p">(</span><span class="n">primes</span><span class="p">))</span>

<span class="n">qi_choices</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">qi</span> <span class="ow">in</span> <span class="n">primes</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">qi</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
        <span class="c1"># qi_choice = [2]
</span>        <span class="n">qi_choice</span> <span class="o">=</span> <span class="p">[</span><span class="nf">mpz</span><span class="p">(</span><span class="nf">int</span><span class="p">(</span><span class="mi">2</span><span class="p">))]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># qi_choice = [1, qi]
</span>        <span class="n">qi_choice</span> <span class="o">=</span> <span class="p">[</span><span class="nf">mpz</span><span class="p">(</span><span class="nf">int</span><span class="p">(</span><span class="mi">1</span><span class="p">)),</span> <span class="nf">mpz</span><span class="p">(</span><span class="nf">int</span><span class="p">(</span><span class="n">qi</span><span class="p">))]</span>
    <span class="n">qi_choices</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="n">qi_choice</span><span class="p">)</span>
    
<span class="n">total</span> <span class="o">=</span> <span class="nf">product</span><span class="p">(</span><span class="nf">len</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">qi_choices</span><span class="p">)</span>

<span class="n">possible_pis</span> <span class="o">=</span> <span class="p">[</span><span class="nf">mpz</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span> <span class="nf">mpz</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span> <span class="nf">mpz</span><span class="p">(</span><span class="mi">2</span><span class="p">)]</span> <span class="c1"># just to be safe
</span><span class="k">for</span> <span class="n">qi_subset</span> <span class="ow">in</span> <span class="nf">tqdm</span><span class="p">(</span><span class="nf">iter_product</span><span class="p">(</span><span class="o">*</span><span class="n">qi_choices</span><span class="p">),</span> <span class="n">total</span><span class="o">=</span><span class="n">total</span><span class="p">):</span>
    <span class="n">possible_pi</span> <span class="o">=</span> <span class="nf">product</span><span class="p">(</span><span class="n">qi_subset</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
    <span class="k">if</span> <span class="n">possible_pi</span><span class="p">.</span><span class="nf">is_prime</span><span class="p">():</span>
        <span class="n">possible_pis</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="n">possible_pi</span><span class="p">)</span>


<span class="n">many_multiple_of_lambda_n</span> <span class="o">=</span> <span class="nf">product</span><span class="p">(</span><span class="n">possible_pis</span><span class="p">)</span>
<span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">Lambda bit length =</span><span class="sh">"</span><span class="p">,</span> <span class="n">many_multiple_of_lambda_n</span><span class="p">.</span><span class="nf">bit_length</span><span class="p">())</span>

<span class="n">d</span> <span class="o">=</span> <span class="nf">pow</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="nf">int</span><span class="p">(</span><span class="n">many_multiple_of_lambda_n</span><span class="p">))</span>
<span class="n">ct</span> <span class="o">=</span> <span class="mh">0x339be515121dab503106cd190897382149e032a76a1ca0eec74f2c8c74560b00dffc0ad65ee4df4f47b2c9810d93e8579517692268c821c6724946438a9744a2a95510d529f0e0195a2660abd057d3f6a59df3a1c9a116f76d53900e2a715dfe5525228e832c02fd07b8dac0d488cca269e0dbb74047cf7a5e64a06a443f7d580ee28c5d41d5ede3604825eba31985e96575df2bcc2fefd0c77f2033c04008be9746a0935338434c16d5a68d1338eabdcf0170ac19a27ec832bf0a353934570abd48b1fe31bc9a4bb99428d1fbab726b284aec27522efb9527ddce1106ba6a480c65f9332c5b2a3c727a2cca6d6951b09c7c28ed0474fdc6a945076524877680</span>
<span class="n">pln</span> <span class="o">=</span> <span class="nf">pow</span><span class="p">(</span><span class="n">ct</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
<span class="nf">print</span><span class="p">(</span><span class="n">pln</span><span class="p">)</span>

<span class="nf">print</span><span class="p">(</span><span class="nb">bytes</span><span class="p">.</span><span class="nf">fromhex</span><span class="p">(</span><span class="nf">hex</span><span class="p">(</span><span class="nf">int</span><span class="p">(</span><span class="n">pln</span><span class="p">))[</span><span class="mi">2</span><span class="p">:]))</span>
</pre></table></code></div></div><h1 id="flag">Flag</h1><p><strong>CTF{Recycling_Is_Great}</strong></p><h1 id="references">References</h1><p><a href="https://documents.uow.edu.au/~jennie/WEBPDF/1999_07.pdf">Marc Gysin and Jennifer Seberry. 1999. Generalised Cycling Attacks on RSA and Strong RSA Primes. In Proceedings of the 4th Australasian Conference on Information Security and Privacy (ACISP ‘99). Springer-Verlag, Berlin, Heidelberg, 149–163.</a></p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/Writeups/categories/google-ctf-2022/'>Google CTF 2022</a>, <a href='/Writeups/categories/cryptography/'>Cryptography</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/Writeups/tags/crypto/" class="post-tag no-text-decoration" >crypto</a> <a href="/Writeups/tags/rsa/" class="post-tag no-text-decoration" >RSA</a> <a href="/Writeups/tags/carmichael/" class="post-tag no-text-decoration" >Carmichael</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Cycling - Writeups&url=http://susanou.github.io/Writeups/posts/cycling/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Cycling - Writeups&u=http://susanou.github.io/Writeups/posts/cycling/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://telegram.me/share?text=Cycling - Writeups&url=http://susanou.github.io/Writeups/posts/cycling/" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i class="fa-fw fas fa-link small" onclick="copyLink()" data-toggle="tooltip" data-placement="top" title="Copy link"></i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down"><div class="access"><div id="access-lastmod" class="post"> <span>Recent Update</span><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/Writeups/posts/cycling/">Cycling</a><li><a href="/Writeups/posts/mlsteal/">MLSteal</a><li><a href="/Writeups/posts/pythia/">Pythia</a><li><a href="/Writeups/posts/ChunkNoris/">Chunk Norris</a><li><a href="/Writeups/posts/Admirer/">Admirer</a></ul></div><div id="access-tags"> <span>Trending Tags</span><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/Writeups/tags/crypto/">crypto</a> <a class="post-tag" href="/Writeups/tags/rsa/">RSA</a> <a class="post-tag" href="/Writeups/tags/easy/">easy</a> <a class="post-tag" href="/Writeups/tags/web/">web</a> <a class="post-tag" href="/Writeups/tags/aes/">AES</a> <a class="post-tag" href="/Writeups/tags/linux/">linux</a> <a class="post-tag" href="/Writeups/tags/misc/">misc</a> <a class="post-tag" href="/Writeups/tags/mitm/">MITM</a> <a class="post-tag" href="/Writeups/tags/sqli/">SQLi</a> <a class="post-tag" href="/Writeups/tags/crt/">CRT</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"> <span class="pl-3 pt-2 mb-2">Contents</span><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="post-extend-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/Writeups/posts/LINECTF/"><div class="card-body"> <span class="timeago small" > Mar 20, 2021 <i class="unloaded">2021-03-20T23:00:00+01:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>LINE CTF</h3><div class="text-muted small"><p> babycrypto1 Source code #!/usr/bin/env python from base64 import b64decode from base64 import b64encode import socket import multiprocessing from Crypto.Cipher import AES from Crypto.Random impo...</p></div></div></a></div><div class="card"> <a href="/Writeups/posts/ChunkNoris/"><div class="card-body"> <span class="timeago small" > Aug 30, 2020 <i class="unloaded">2020-08-30T14:50:00+02:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Chunk Norris</h3><div class="text-muted small"><p> Chunk Norris (easy) Code given #!/usr/bin/python3 -u import random from Crypto.Util.number import * import gmpy2 a = 0xe64a5f84e2762be5 chunk_size = 64 def gen_prime(bits): s = random.getran...</p></div></div></a></div><div class="card"> <a href="/Writeups/posts/RSA-Multiple-Recipients/"><div class="card-body"> <span class="timeago small" > Nov 16, 2020 <i class="unloaded">2020-11-16T23:00:00+01:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>RSA Multiple Recipients</h3><div class="text-muted small"><p> Hastad Attack Let’s go over the math of the attack: Assume Bob sends the same message to multiple people using RSA with different modulus but the same e for all of the messages. Assume that this ...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/Writeups/posts/static-client2/" class="btn btn-outline-primary" prompt="Older"><p>Static Client 2</p></a> <a href="/Writeups/posts/mlsteal/" class="btn btn-outline-primary" prompt="Newer"><p>MLSteal</p></a></div><div id="disqus" class="pt-2 pb-2"><p class="text-center text-muted small pb-5"> Comments powered by <a href="https://disqus.com/">Disqus</a>.</p></div><script src="/Writeups/assets/js/lib/jquery.disqusloader.min.js"></script> <script> const options = { scriptUrl: '//writeups-fukurou.disqus.com/embed.js', disqusConfig: function() { this.page.title = 'Cycling'; this.page.url = 'http://susanou.github.io/Writeups/posts/cycling/'; this.page.identifier = '/posts/cycling/'; } }; $.disqusLoader('#disqus', options); </script></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center"><div class="footer-left"><p class="mb-0"> © 2025 <a href="https://github.com/Susanou">Cameron Hochberg</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div><script data-name="BMC-Widget" data-cfasync="false" src="https://cdnjs.buymeacoffee.com/1.0.0/widget.prod.min.js" data-id="Susanou" data-description="Support me on Buy me a coffee!" data-message="" data-color="#5F7FFF" data-position="Right" data-x_margin="18" data-y_margin="18"></script></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><h4 class="text-muted mb-4">Trending Tags</h4><a class="post-tag" href="/Writeups/tags/crypto/">crypto</a> <a class="post-tag" href="/Writeups/tags/rsa/">RSA</a> <a class="post-tag" href="/Writeups/tags/easy/">easy</a> <a class="post-tag" href="/Writeups/tags/web/">web</a> <a class="post-tag" href="/Writeups/tags/aes/">AES</a> <a class="post-tag" href="/Writeups/tags/linux/">linux</a> <a class="post-tag" href="/Writeups/tags/misc/">misc</a> <a class="post-tag" href="/Writeups/tags/mitm/">MITM</a> <a class="post-tag" href="/Writeups/tags/sqli/">SQLi</a> <a class="post-tag" href="/Writeups/tags/crt/">CRT</a></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.7.3/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/Writeups/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="http://susanou.github.io{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script>
